
## What is this?
A small web host that uses only node's built-ins to handle:
 - static content (filesystem index)
 - dynamic content (server-side javascript)
 - secure authentication ([HTTP Basic](https://tools.ietf.org/html/rfc7617), [TLS](https://tools.ietf.org/html/rfc8446), [pbkdf2](https://tools.ietf.org/html/rfc8018))
 - simple authorization (No groups, roles, or regex matches)

This is my take on a minimalist web host with code that
can be fully reviewed in an hour and run directly from
source with no dependencies ([one dependency](https://nodejs.org)).

To that end, you may notice that there are no package, grunt, trevor, cargo,
slurp, jarvis, babel, lint, or docker files. The .git folder is the only dev
tool sub-directory.

The setup script targets [systemd](https://systemd.io/) to install this software as a persistent service but the project is otherwise system-agnostic.

## Why?
Small-scale web publishing should be simple.

A CS degree should not feel like a requirement for self-hosting your resume, blog, or photos.

# Quick Start
**Install Node**: [https://nodejs.org/](https://nodejs.org/)

**Download and extract the source code**: [https://github.com/shuntress/web-core/archive/main.zip](https://github.com/shuntress/web-core/archive/main.zip)  
*(alternatively, you can use [Git](https://git-scm.com/downloads) to clone the repository: `git clone https://github.com/shuntress/web-core.git`)*  

**Navigate to your install location**: `cd {path/to/web-core-main/on/your/system}`  
*(the folder will be named `web-core-main` if you downloaded the archive zip file. It will be named `web-core` if you cloned the repository without changing its name)*

**Run the site**: `node src/site.js`

**Check the status page**: [http://localhost/status](http://localhost/private/status)

**Add some test content**: `echo "test file, please ignore" > www/testfile.txt`  
[http://localhost/testfile.txt](http://localhost/testfile.txt)

---

## Slightly Slower Start

This builds on the quick start by adding a certificate to enable HTTPS and user authentication/authorization.

**Create your certificate**: `openssl req -newkey rsa:2048 -nodes -keyout administration/key.pem -x509 -days 365 -out administration/certificate.pem`  
*You can use [openssl](https://www.openssl.org/) to generate your own un-trustworthy certificate or have a certificate generated by trusted source like [letsencrypt](https://letsencrypt.org/getting-started/)*  
*If this step is confusing, read up on [TLS](https://en.m.wikipedia.org/wiki/Transport_Layer_Security) and [Public Key Cryptography](https://en.m.wikipedia.org/wiki/Public-key_cryptography).*  
*Admittedly, it does feel like a CS degree would help with this part.*

**Enable HTTPS**: Create `administration/config.json` with the content  
*This also automatically redirects all HTTP traffic.*
```
{
   "useHttps": true
}
```

**Add a some test private content**
 - `mkdir www/private`
 - `echo "private test file" > www/private/testfile.txt`

[https://localhost/private/testfile.txt](https://localhost/private/testfile.txt)  
*This should fail because you have no login.*

**Request a new account**: [https://localhost/account](https://localhost/account)

**Approve your request**: Copy the contents of `administration/account_creation_requests.txt` to `administration/user_credentials.txt`.  
*User credentials are loaded once during initialization. If `user_credentials.txt` is missing, it will be created automatically.*

**Restart the site**: `CTRL+C` then `node src/site.js`.

**Check the status page**: [https://localhost/status](https://localhost/private/status)

## Authorization
When HTTPS is enabled, resources may be setup to require authorization.

Any URL with `private` in the path will require the user to log in.

Authentication may be controlled per-directory by adding a newline-separated list of user names in a file called `.authorized_users`.

When any static resource is requested, the index module will recurse up the tree towards the root looking for an `.authorized_users` file.  
If no `.authorized_users` file is found, the request will be **accepted**.  
If the first `.authorized_users` lists the user's name, the request will be **accepted**.  
If the first `.authorized_users` does not list the user's name, the request will be **rejected**.

If a list of authorized users exists for a resource that does not have `private` in the path, the user will be prompted to login because a name is required for authorization.

## Configuration Options
Config defaults are in [src/config.js](https://github.com/shuntress/web-core/blob/main/src/config.js).

Defaults may be overridden by setting the corresponding property in `administration/config.json`
